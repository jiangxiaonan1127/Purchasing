<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<HEAD><TITLE>需求一览表</TITLE>

<SCRIPT language=JAVASCRIPT> 
function select_check(theForm)
      {
        var count=0;
        for (var k = 0; k < theForm.length; k++)
        if ((theForm[k].type == "checkbox") && (theForm[k].checked))
        count++;
         if (count==0)
         {
            for (k = 0; k < theForm.length; k++)
            {
              if (theForm[k].type == "checkbox")
              theForm[k].checked=true;
            }
         }
         else
         {
            for (k = 0; k < theForm.length; k++)
            {
              if (theForm[k].type == "checkbox")
              theForm[k].checked=false;
            }
         }
      }
function chck()
{  var  count=0;
   for (var i=0;i<form.length;i++)
   if ((form[i].type == "radio") && (form[i].checked))
   count++; 
   if (count==0)
      { return false;  }
   else
      { return true;   }
}
 
function Add(SourceList,TargetList)
	{
	var nIndex = SourceList.selectedIndex;
 	var nCount = 0;  
	if (nIndex == -1)
	{
		// Process continue only if at least one item selected
		//alert("请先选择一项!");
		return;
	}
	for (i=0;i<SourceList.length;i++)
  {
     if (SourceList.options(i).selected==true)
     {    
         if (inSouceList(SourceList.options(i).value,TargetList)==false)
         {
          	var objSelected = new Option(SourceList[i].text, SourceList[i].value);
           	TargetList.options[TargetList.length] = objSelected;
         }
     }     
	}
  for (var i=0;i<TargetList.options.length;i++)
  {
    TargetList.options(i).selected=true;
  }
	if(navigator.appName=="Netscape")
	{
		history.go(0)
	}
 }
 function inSouceList(SourceListOption,TargetList)
 {
 	  for (i=0;i<TargetList.length;i++)
    {
	     if (TargetList.options[i].value==SourceListOption)
       {
        	 return true;
       }
    }   
    return false;
 }  
function Remove(SelectList)
	{
	var nIndex = SelectList.selectedIndex;
 	var nCount = 0;
	if (nIndex == -1)
	{
		// Process continue only if at least one item selected
		//alert("请先选择一项!");
		return;
	}
  while(nCount<SelectList.length)
  {
       if (SelectList.options(nCount).selected==true)
       {
       	 SelectList.options[nCount] = null;
       }
       else
       {
         nCount++;
       }
  }
	if(navigator.appName=="Netscape")
		{
		history.go(0)
		}	
	}
 function enter()
 {
   var srcEle = window.event.srcElement;
   var tmp;   
   tmp = window.showModalDialog("pub_pub.Dialog_Date?vc_input=" + srcEle.value);
     if ( tmp.indexOf("/") != -1)
     {
        srcEle.value = tmp;
     }
     return;
 }   
 function check_num()
 {
 	 if (window.event.keyCode > 57 || window.event.keyCode < 48)
	 {
	 		window.event.returnValue = false;
	 }
 }
 function check_blank()
 {
 	 if (window.event.keyCode < 48)
	 {
	 		window.event.returnValue = false;
	 }
 }
  
function check_num_dot()
{
 	 if (window.event.keyCode > 57 || window.event.keyCode < 46)
	 {
  		 window.event.returnValue = false;   
	 }
   else
   {
      if(window.event.keyCode==47)
      {
    		 window.event.returnValue = false;
      }
      if(window.event.keyCode==46)
      {
         if (window.event.srcElement.value.indexOf(".")!=-1)
         {
        		 window.event.returnValue = false;
         }
      }   
    }  
 }
  
 function submitonce(theform)
 {
 if (document.all || document.getElementById)
 {
 for (i=0;i<theform.length;i++)
 {
 var tempobj = theform.elements[i]
 if (tempobj.type.toLowerCase() =="button")
 tempobj.disabled = true
 }
 }
 }
 
  function CheckAll() 
 {
   var i = 0;
   for (i=0; i < window.document.forms[0].elements.length; i++) 
   {
     if(window.document.forms[0].elements[i].Chk<3) 
     {
       if(window.document.forms[0].elements[i].value=="")
       {
         alert(window.document.forms[0].elements[i].alt);
         window.document.forms[0].elements[i].focus();
         return;
       }
       else if (window.document.forms[0].elements[i].Chk==2)
       {
         if (NotNumber(window.document.forms[0].elements[i].value))
         {
            alert("提示信息：\n不是有效的数字，请重新输入。");
            window.document.forms[0].elements[i].focus();
            return;
         }
       }
     }
     else if(window.document.forms[0].elements[i].Chk==3)
     {
       if(window.document.forms[0].elements[i].value!="")
       {
         if (NotNumber(window.document.forms[0].elements[i].value))
         {
            alert("提示信息：\n不是有效的数字，请重新输入。");
            window.document.forms[0].elements[i].focus();
            return;
         }
       }
     }
   }
   window.document.forms[0].submit();
   return true;
 }
 function NotNumber(Field)
 {
   var j = 0;
   var k = 0;
   for (var i=0; i<Field.length; i++)
   {
      var ch=Field.substring(i,i+1);
      if((ch>="0")&&(ch<="9")) 
      {
        j=0;
      }
      else if(ch==".") 
      {
        k++;
      }
      else
      {
        j=1;
        break;
      }
   }
   if ((j==0)&&(k<2))
   {
      return false;
   }
   else
   {
      return true;
   }
 }
 function openwindown(page)
 {
    window.open(page,"newuser","toolbar=no,location=no,directories=no,status=no,menubar=no,scrollbars=yes,resizable=yes,width=700,height=400,left=100,top=150");
 }
 
 function print_order_detail(){
	  	window.open("print_order_detail.htm","Canny2","toolbar=0,location=0,status=0,menubar=0,scrollbars=0,width=600,height=440,left=100,top=60");
	  }
	  
	 
</SCRIPT>

<META http-equiv=Content-Language content=zh-cn>
<META http-equiv=Content-Type content="text/html; charset=UTF-8">
<META content="MSHTML 6.00.2900.5626" name=GENERATOR>
<META content=FrontPage.Editor.Document name=ProgId>
  <LINK href="css/style.css" rel=stylesheet>
  <link rel="stylesheet" type="text/css" href="../jquery-easyui-1.8.5/themes/default/easyui.css">
  <link rel="stylesheet" type="text/css" href="../jquery-easyui-1.8.5/themes/icon.css">
  <script type="text/javascript" src="../jquery-easyui-1.8.5/jquery.min.js"></script>
  <script type="text/javascript" src="../jquery-easyui-1.8.5/jquery.easyui.min.js"></script>
<SCRIPT language=JavaScript src="css/pub_Calendar.js"></SCRIPT>
<SCRIPT language=javascript>
      function submit_form(theForm,i)
      {
	  
        var count=0;
        for (var k = 0; k < theForm.length; k++)
        if ((theForm[k].type == "radio") && (theForm[k].checked))
        count++;
        if (count==0)
        {
          alert("提示信息：\n请选择需求计划。");
          return;
        }
        document.form.p_type.value=i;
        window.document.form.submit();
        return true;
      }
      function submit_form_cx()
      {
        form.action="Order_ytb_list.asp";
        window.document.form.submit();
      }
	   function workLog01() 
 	 {
  		window.open("work_log01.htm","Canny1","toolbar=0,location=0,status=0,menubar=0,scrollbars=0,width=600,height=440,left=100,top=60");
      
 	 }
	 
		 
	 function update_xuqiujihua(){
	
	 	var obj = document.getElementsByName("checkbox");
		var len = obj.length;
		var count=0;
		var no=0;
		for(var i=0;i<len;i++){
			if(obj[i].checked){
				count++;
				var objTable = document.getElementById("table1");
				var oldTr=objTable.rows[i+1];
				if(oldTr.cells[6].innerText=="确定"){
					alert("已确定的需求计划不能修改！");
					no=1;
					break;
				}
			}
		}
		if(count==0){
			alert("至少选择一条数据修改！");
		}else if(count>1){
			alert("一次只能修改一条数据！");
		}else if(no=0){
				window.location="update_xuqiujihua.htm";
				}
	 }
	 
	  function quedingData(){
	 	var obj = document.getElementsByName("checkbox");
		var len = obj.length;
	 	var count=0;
		var no=0;
		for(var i=0;i<len;i++){
			if(obj[i].checked){
				count++;
				var objTable = document.getElementById("table1");
				var oldTr=objTable.rows[i+1];
				if(oldTr.cells[6].innerText=="确定"){
					alert("选定的数据中有数已确定，请重新选择。");
					no=1;
					break;
				}
			}
		}
		if(count==0){
			alert("至少选择一条数据！");
		}else if(no!=1){
			
			for(var i=0;i<len;i++){
			if(obj[i].checked){
				var objTable = document.getElementById("table1");
				var oldTr=objTable.rows[i+1];
				oldTr.cells[6].innerText="确定";
			}
		}
		}		
	}
	 
	 function getLen(){
		 obj01=document.getElementById("table1");
	 	cGetRow=window.event.srcElement.parentElement.parentElement.rowIndex;
	 }
	 
	 
	 function delData(){
	 	var obj = document.getElementById("p_orderno");
	 	if(obj.checked){
			obj01.deleteRow(cGetRow);
		}else{
			alert("请选择要删除的数据！");
		}
	 }
	
	 function opp(obj){
	  var c=document.getElementById("xiugai");
	   var d=document.getElementById("shanchu");
	  c.disabled=obj;
	   d.disabled=obj;
	 
	 }
	 
	  function ddtzDdmx() 
 	 {
	 	var obj = document.getElementsByName("checkbox");
		var len = obj.length;
	 	var count=0;
		for(var i=0;i<len;i++){
			if(obj[i].checked){
				count++;
			}
		}
		if(count==0){
			alert("至少选择一条数据！");
		}else if(count>1){
			alert("一次只能查看一条数据！");
		}else{
			window.open("print_order_detail.htm","Canny2","toolbar=0,location=0,status=0,menubar=0,scrollbars=0,width=600,height=440,left=100,top=60");
			
		}
  		
      
 	 }
</SCRIPT>

  <script type="text/javascript" th:inline="none">
    //EaysUI表信息
    $(function () {
      var url;
      $("#dg").datagrid({
        url:"/findAllOrders",
        pagination:true,
        rownumbers:true,
        singleSelect:true,
        pageList:[10,8,6,4,2],
        columns:[[
          {field:'id',title:'序号',width:'10%'},
          {field:'materialCode',title:'物资编号',width:'20%'},
          {field:'materialName',title:'产品名称',width:'40%'},
          {field:'amount',title:'数量',width:'10%'},
          {field:'status',title:'采购进度',width:'20%',formatter:function (value,row,index) {
                  if (row.status=="C001-10"){
                    return "未完成";
                  }else {
                    return "完成";
                  }
            }}
        ]]
      });
    });
    //确认需求计划后改变状态
    function updateStatus(){
      var row = $('#dg').datagrid('getSelected');
      console.log(row.status);
      if (row){
        if (row.status=="C001-10"){
          $.ajax({
            url:"/updateStatus",
            data:"orderId="+row.id,
            type:"post",
            success:function (data) {
              if (data=="success"){
                $.messager.show({
                  title:'系统提示',
                  msg:'确认完毕',
                  timeout:3000,
                  showType:'slide'
                });
                //刷新
                $('#dg').datagrid('reload');
              }
            }
          });
        }else {
          $.messager.alert('警告','已经确认');
        }
      }else {
        $.messager.alert('警告','请选择一行');
      }
    }
    //修改需求计划
    function editOrder() {
      var row = $('#dg').datagrid('getSelected');
      if (row){
        if(row.status=="C001-10"){
          $('#dlg').dialog('open').dialog('setTitle','修改需求计划');
          $('#fm').form('load',row);
          url = "/editOrder";
        }else {
          $.messager.alert('警告','确认的需求订单不可修改');
        }
      }else {
        $.messager.alert('警告','请选择一行');
      }
    }
    //查询详细信息
    function searchOrder() {
      var row = $('#dg').datagrid('getSelected');
      if (row){
          $('#searchdlg').dialog('open').dialog('setTitle','详细需求计划');
          $('#searchfm').form('load',row);
      }else {
        $.messager.alert('警告','请选择一行');
      }
    }
    //删除需求信息
    function delOrder() {
      var row = $('#dg').datagrid('getSelected');
      if (row){
        if(row.status=="C001-10"){
          $.ajax({
            url:"delOrder",
            data:"orderId="+row.id,
            type:"post",
            success:function (data) {
              //弹出框
              $.messager.show({
                title:'系统提示',
                msg:'删除成功',
                timeout:3000,
                showType:'slide'
              });
              //刷新
              $('#dg').datagrid('reload');
            }
          });
        }else {
          $.messager.alert('警告','确认的需求订单不可删除');
        }
      }else {
        $.messager.alert('警告','请选择一行');
      }
    }
    //提交表对话框表单
    function saveOrder() {
      console.log(1);
      var row = $('#dg').datagrid('getSelected');
      console.log(2);
      $("#fm").form('submit',{
        url:url,
        onSubmit:function () {
          return $(this).form('validate');
        },
        success:function (result) {
          console.log(3);
          console.log(result);
          if (result=="success"){
            //弹出框
            $.messager.show({
              title:'系统提示',
              msg:'操作成功',
              timeout:3000,
              showType:'slide'
            });
            //关闭当前添加窗口
            $('#dlg').dialog('close');
            //刷新
            $('#dg').datagrid('reload');

          }
        }
      });
    }
  </script>
</HEAD>
<BODY>
<CENTER>
  <INPUT type=hidden value=3 name=p_type>
<H2><FONT color=#0070c0>需求计划一览表</FONT></H2>
<TABLE cellSpacing=1 cellPadding=0 width="100%" bgColor=#ffffff borderColorLight=#ffffff border=0>
  <TBODY>
  <TR>
    <TD>
      <TABLE cellSpacing=1 cellPadding=3 width="100%" border=0>
        <TBODY>
        <TR>
          <TD noWrap align=middle>
            物资编码：<INPUT size=10 name=p_prodno>&nbsp;&nbsp;
            物资名称：<INPUT size=10 name=p_prodname>&nbsp;&nbsp;
            状态：
            <SELECT style="WIDTH: 115px" name=p_status>
              <OPTION value="" selected>全部</OPTION>
              <OPTION value=70>未确定</OPTION>
              <OPTION value=70>确定</OPTION>
            </SELECT>
            <INPUT onclick=submit_form_cx() type=button value=查询>
          </TD>
        </TR>
        </TBODY>
      </TABLE>
    </TD>
  </TR>
  </TBODY>
</TABLE>
  <!--分割线-->
  <table id="dg" toolbar="#toolbar"></table>
  <!--工具栏-->
  <div id="toolbar">
    <a href="#" class="easyui-linkbutton" iconCls="icon-add" plain="true" onclick="updateStatus()">确定需求计划</a>
    <a href="#" class="easyui-linkbutton" iconCls="icon-edit" plain="true" onclick="editOrder()">修改需求计划</a>
    <a href="#" class="easyui-linkbutton" iconCls="icon-search" plain="true" onclick="searchOrder()">详细信息</a>
    <a href="#" class="easyui-linkbutton" iconCls="icon-cancel" plain="true" onclick="delOrder()">删除</a>
  </div>
  <!--修改需求信息表对话框-->
  <div id="dlg" class="easyui-dialog" style="width:550px" data-options="closed:true,modal:true,border:'thin',buttons:'#dlg-buttons'">
    <form id="fm" method="post" novalidate style="margin:0;padding:20px 50px">
      <input name="id" type="hidden">
      <table style="text-align: center">
        <tr>
          <td><label>需求计划编号：</label></td>
          <td>
            <input id="orderNum" name="orderNum" readonly="readonly" style="width: 100%;background-color: #99ccff">
          </td>
          <td><label>产品编号：</label></td>
          <td>
            <input id="materialCode" name="materialCode" readonly="readonly" style="width: 100%;background-color: #99ccff">
          </td>
        </tr>

        <tr>
          <td><label>产品名称：</label></td>
          <td>
            <input id="materialName" name="materialName" readonly="readonly" style="width: 100%;background-color: #99ccff">
          </td>
          <td><label>计数单位：</label></td>
          <td>
            <input id="materialUnit" name="measureUnit" style="width: 100%">
          </td>
        </tr>

        <tr>
          <td><label>数量：</label></td>
          <td>
            <input id="amount" name="amount" style="width: 100%">
          </td>
          <td><label>预单价：</label></td>
          <td>
            <input id="unitPrice" name="unitPrice"style="width: 100%">
          </td>
        </tr>

        <tr>
          <td><label>开始交货日期：</label></td>
          <td>
            <input id="startDate" name="startDate" readonly="readonly" type="date"style="width: 100%;background-color: #99ccff">
          </td>
          <td><label>业务员：</label></td>
          <td>
            <input id="author" name="author" readonly="readonly" style="width: 100%;background-color: #99ccff">
          </td>
        </tr>

        <tr>
          <td><label>电子邮件：</label></td>
          <td>
            <input id="email" name="email" readonly="readonly" style="width: 100%;background-color: #99ccff">
          </td>
          <td><label>联系电话：</label></td>
          <td>
            <input id="phone" name="phone" readonly="readonly" style="width: 100%;background-color: #99ccff">
          </td>
        </tr>

        <tr>
          <td><label>联系传真：</label></td>
          <td>
            <input id="fax" name="fax" readonly="readonly" style="width: 100%;background-color: #99ccff">
          </td>
          <td><label>备注：</label></td>
          <td>
            <input id="remark" name="remark" style="width: 100%">
          </td>
        </tr>
      </table>
    </form>
  </div>
  <div id="dlg-buttons">
    <a href="javascript:void(0)" class="easyui-linkbutton c6" iconCls="icon-ok" onclick="saveOrder()" style="width:90px">提交</a>
    <a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-cancel" onclick="javascript:$('#dlg').dialog('close')" style="width:90px">取消</a>
  </div>
  <!--详细信息表对话框-->
  <div id="searchdlg" class="easyui-dialog" style="width:550px" data-options="closed:true,modal:true,border:'thin',buttons:'#searchdlg-buttons'">
  <form id="searchfm" method="post" novalidate style="margin:0;padding:20px 50px">
    <table style="text-align: center">
      <tr>
        <td><label>需求计划编号：</label></td>
        <td>
          <input  name="orderNum" readonly="readonly" style="width: 100%;background-color: #99ccff">
        </td>
        <td><label>产品编号：</label></td>
        <td>
          <input  name="materialCode" readonly="readonly" style="width: 100%;background-color: #99ccff">
        </td>
      </tr>

      <tr>
        <td><label>产品名称：</label></td>
        <td>
          <input  name="materialName"readonly="readonly"style="width: 100%;background-color: #99ccff">
        </td>
        <td><label>计数单位：</label></td>
        <td>
          <input  name="measureUnit" readonly="readonly"style="width: 100%;background-color: #99ccff">
        </td>
      </tr>

      <tr>
        <td><label>数量：</label></td>
        <td>
          <input  name="amount"readonly="readonly" style="width: 100%;background-color: #99ccff">
        </td>
        <td><label>预单价：</label></td>
        <td>
          <input  name="unitPrice"readonly="readonly"style="width: 100%;background-color: #99ccff">
        </td>
      </tr>

      <tr>
        <td><label>开始交货日期：</label></td>
        <td>
          <input  name="startDate" readonly="readonly"type="date"style="width: 100%;background-color: #99ccff">
        </td>
        <td><label>业务员：</label></td>
        <td>
          <input  name="author" readonly="readonly" style="width: 100%;background-color: #99ccff">
        </td>
      </tr>

      <tr>
        <td><label>电子邮件：</label></td>
        <td>
          <input  name="email" readonly="readonly" style="width: 100%;background-color: #99ccff">
        </td>
        <td><label>联系电话：</label></td>
        <td>
          <input  name="phone" readonly="readonly" style="width: 100%;background-color: #99ccff">
        </td>
      </tr>

      <tr>
        <td><label>联系传真：</label></td>
        <td>
          <input  name="fax" readonly="readonly" style="width: 100%;background-color: #99ccff">
        </td>
        <td><label>备注：</label></td>
        <td>
          <input  name="remark" readonly="readonly" style="width: 100%;background-color: #99ccff">
        </td>
      </tr>
    </table>
  </form>
  </div>
  <div id="searchdlg-buttons">
    <a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-cancel" onclick="javascript:$('#searchdlg').dialog('close')" style="width:90px">关闭</a>
  </div>
</CENTER>
</BODY>
</HTML>
